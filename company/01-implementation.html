<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Laboratorio :: Red Hat Innovate Together</title>
    <link rel="canonical" href="https://github.com/dgpmakes/instructlab-start/company/01-implementation.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="02-annex.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://github.com/dgpmakes/instructlab-start">Red Hat Innovate Together</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="company" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Antes de empezar</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#instructlab">¬°Bienvenido al workshop!</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#objetivos">Objetivos</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-implementation.html">Laboratorio</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#uso-basico">Comprender el laboratorio</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#uso-basico">1. Interactuar con un modelo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#entrenamiento">2. Entrenar modelo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#interaccion">3. Comprobar modelo entrenado</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-annex.html">Anexo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-annex.html#que-es-un-llm">¬øQu√© es un LLM?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-annex.html#como-entrenar-llm">¬øC√≥mo se entrenan los LLM?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-annex.html#relacion-instructlab">¬øC√≥mo se relaciona con InstructLab?</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Company</a></li>
    <li><a href="01-implementation.html">Laboratorio</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/dgpmakes/instructlab-start/edit/master/documentation/modules/ROOT/pages/01-implementation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Laboratorio</h1>
<div class="sect1">
<h2 id="comprender"><a class="anchor" href="#comprender"></a>üîç Comprender el entorno</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ech√©mosle un vistazo al laboratorio. Si a√∫n no lo has hecho, oculta las instrucciones del laboratorio en ingl√©s situando el rat√≥n entre las instrucciones y los terminales y deslizando al m√°ximo a la izquierda. Por comodidad, deja el entorno en la parte derecha de tu pantalla y las instrucciones en espa√±ol a la izquierda.</p>
</div>
<div class="paragraph">
<p>En la web del entorno, vemos en la esquina superior izquierda dos pesta√±as. En "Terminals", veremos un terminal arriba y un terminal abajo. Est√°n conectados a la misma m√°quina virtual y son id√©nticos. Por lo general escribiremos en el de arriba, luego en las instrucciones se especifica cuando pasar a abajo.</p>
</div>
<div class="paragraph">
<p>En la segunda pesta√±a, leemos "Parasol". Esta es la web de nuestra empresa ficticia que queremos mejorar gracias a nuestro trabajo con InstructLab.</p>
</div>
<div class="paragraph">
<p>En las instrucciones que vamos a seguir, ver√°s rect√°ngulos naranjas que incluyen comandos o frases. En ellos, puedes clicar en el icono de la derecha para directamente copiar esos fragmentos. ¬°Algo √∫til para facilitar el laboratorio!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uso-basico"><a class="anchor" href="#uso-basico"></a>1. Interactuar con un modelo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nuestra primera tarea ser√° ofrecer en nuestra web un chatbot al que hacer preguntas sobre siniestros de coches. ¬°Calma! Tenemos toda la interfaz gr√°fica y un modelo de lenguaje listo para hacerlo. En este caso, usaremos InstructLab para servir un modelo y as√≠ hacerle llamadas desde nuestra web.</p>
</div>
<div class="sect2">
<h3 id="_preparaci√≥n_del_entorno"><a class="anchor" href="#_preparaci√≥n_del_entorno"></a>Preparaci√≥n del entorno</h3>
<div class="paragraph">
<p>Para utilizar InstructLab, debemos de cumplir con estos requisitos:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Un sistema Linux.</p>
</li>
<li>
<p>Python 3.10 o 3.11.</p>
</li>
<li>
<p>Un m√≠nimo de 250GB de espacio en el disco.</p>
</li>
<li>
<p>Compilador de C + +.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No hay que preocuparse por ello ahora mismo, el laboratorio cumple con todos esos requisitos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejecutar_instructlab"><a class="anchor" href="#_ejecutar_instructlab"></a>Ejecutar InstructLab</h3>
<div class="paragraph">
<p>Lo primero que tenemos que hacer es crear un entorno virtual Python que nos permitir√° interactuar con la l√≠nea de comandos de InstructLab. Escribe los siguientes comandos en el terminal superior:</p>
</div>
<div class="paragraph">
<p>Dirigete hasta la carpeta predefinida InstructLab y activa el entorno virtual python ejecutando los siguientes comandos:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/instructlab
source venv/bin/activate</code></pre>
</div>
</div>
<div class="paragraph">
<p>El terminal deber√≠a parecerse a esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">(venv) [instruct@bastion instructlab]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta forma, ya podemos usar InstructLab con el comando <code>ilab</code> desde el entorno virtual de Python. Verif√≠calo con este comando:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deber√≠as obtener esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Usage: ilab [OPTIONS] COMMAND [ARGS]...


  CLI for interacting with InstructLab.


  If this is your first time running ilab, it`s best to start with `ilab config init`
  to create the environment.


Options:
  --config PATH  Path to a configuration file.  [default: /home/instruct/.config/instructlab/config.yaml]
  -v, --verbose  Enable debug logging (repeat for even more verbosity)
  --version      Show the version and exit.
  --help         Show this message and exit.

Commands:
  config    Command Group for Interacting with...
  data      Command Group for Interacting with...
  model     Command Group for Interacting with...
  system    Command group for all system-related...
  taxonomy  Command Group for Interacting with...

Aliases:
  chat      model chat
  generate  data generate
  serve     model serve
  train     model train</code></pre>
</div>
</div>
<div class="paragraph">
<p>¬°Perfecto! Estamos listos para meternos de lleno con InstructLab.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configurar_instructlab"><a class="anchor" href="#_configurar_instructlab"></a>Configurar InstructLab</h3>
<div class="paragraph">
<p>Para empezar a trabajar, InstructLab necesita <strong>inicializar</strong>. El comando <code>ilab config init</code> se encarga de:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crear una estructura de directorios para los modelos, datos generados, etc..</p>
</li>
<li>
<p>Establecer una configuraci√≥n y taxonom√≠a inicial (estructura de conocimientos y habilidades).</p>
</li>
<li>
<p>Detectar la CPU y GPU de nuestro sistema.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Introduce el siguiente comando:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab config init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deber√≠as recibir el siguiente output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Welcome to InstructLab CLI. This guide will help you to setup your environment.
Please provide the following values to initiate the environment [press Enter for defaults]:
Path to taxonomy repo [/home/instruct/.local/share/instructlab/taxonomy]:</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, pulsaremos la tecla ENTER. Eso har√° que usemos una taxonom√≠a por defecto. M√°s adelante explicamos qu√© son las taxonom√≠as.</p>
</div>
<div class="paragraph">
<p>El comando continuar√° y lo siguiente que ense√±ar√° es esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Path to your model [/home/instruct/.cache/instructlab/models/merlinite-7b-lab-Q4_K_M.gguf]:
Generating
/home/instruct/.config/instructlab/config.yaml
...
Detecting Hardware...
We chose Nvidia 1x L4 as your designated training profile. This is for systems with 24 GB of vRAM.
This profile is the best approximation for your system based off of the amount of vRAM. We modified it to match the number of GPUs you have.
Is this profile correct? [Y/n]: Y</code></pre>
</div>
</div>
<div class="paragraph">
<p>El comando ha detectado que estamos usando un hardware espec√≠fico de Nvidia con 24GB de VRAM, as√≠ que ha adaptado el funcionamiento de InstructLab para sacar todo el potencial de nuestro sistema.</p>
</div>
<div class="paragraph">
<p>Ahora, pulsaremos la tecla Y y luego ENTER.</p>
</div>
<div class="paragraph">
<p>Si todo ha ido bien, el comando terminar√° avis√°ndonos de que la inicializaci√≥n ha sido completada con √©xito.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">'Initialization completed successfully, you`re ready to start using ilab. Enjoy!'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Durante la fase de inicializaci√≥n pasan varias cosas. Se crea una taxonom√≠a por defecto en el sistema de archivos local y un archivo de configuraci√≥n (config.yaml) en el directorio ‚Äúhome/instruct/.config/instructlab/‚Äù.</p>
</div>
<div class="paragraph">
<p>El archivo config.yaml contiene los par√°metros por defecto que utilizaremos durante este laboratorio para personalizar el desempe√±o de InstructLab. Si decides experimentar con InstructLab despu√©s del evento, es importante que eches un ojo a este archivo para que puedas ajustar los par√°metros a tu gusto.</p>
</div>
</div>
<div class="sect2">
<h3 id="_descargar_modelos"><a class="anchor" href="#_descargar_modelos"></a>Descargar modelos</h3>
<div class="paragraph">
<p>Con el entorno InstructLab configurado, ahora descargaremos dos modelos cuantificados (es decir, comprimidos y optimizados) en el directorio local. Estamos utilizando modelos cuantificados porque disponemos de una √∫nica GPU para este laboratorio. Para un mayor rendimiento o casos de uso en producci√≥n, se utilizar√≠an modelos sin cuantificar.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Granite se utilizar√° como un servidor de modelos para las solicitudes de la API.</p>
</li>
<li>
<p>Merlinite nos ayudar√° a crear datos sint√©ticos para entrenar un nuevo modelo.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Primero, descargaremos el modelo Granite:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model download --repository instructlab/granite-7b-lab-GGUF --filename=granite-7b-lab-Q4_K_M.gguf --hf-token $HUGGINGFACE_RO_TOKEN</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y ahora hacemos igual para Merlinite:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model download --repository instructlab/merlinite-7b-lab-GGUF --filename=merlinite-7b-lab-Q4_K_M.gguf --hf-token $HUGGINGFACE_RO_TOKEN</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como puedes ver, el comando ilab model download descarga los modelos desde el repositorio oficial de InstructLab en HuggingFace.</p>
</div>
<div class="paragraph">
<p>El output despu√©s de descargar cada modelo debe parecese a esto:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Downloading model from Hugging Face: instructlab/granite-7b-lab-GGUF@main to /home/instruct/.cache/instructlab/models...
Downloading 'granite-7b-lab-Q4_K_M.gguf' to '/home/instruct/.cache/instructlab/models/.cache/huggingface/download/granite-7b-lab-Q4_K_M.gguf.6adeaad8c048b35ea54562c55e454cc32c63118a32c7b8152cf706b290611487.incomplete'
INFO 2024-09-10 16:51:32,740 huggingface_hub.file_download:1908: Downloading 'granite-7b-lab-Q4_K_M.gguf' to '/home/instruct/.cache/instructlab/models/.cache/huggingface/download/granite-7b-lab-Q4_K_M.gguf.6adeaad8c048b35ea54562c55e454cc32c63118a32c7b8152cf706b290611487.incomplete'
granite-7b-lab-Q4_K_M.gguf: 100%|‚ñà| 4.08G/4.08G [00:19&lt;00:00, 207
Download complete. Moving file to /home/instruct/.cache/instructlab/models/granite-7b-lab-Q4_K_M.gguf
INFO 2024-09-10 16:51:52,562 huggingface_hub.file_download:1924: Download complete. Moving file to /home/instruct/.cache/instructlab/models/granite-7b-lab-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora que los modelos est√°n descargados, podemos servir y chatear con el modelo Granite. Servir el modelo simplemente significa que vamos a ejecutar un servidor que permitir√° a otras herramientas interactuar de forma similar a hacer una llamada a la API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_servir_un_modelo"><a class="anchor" href="#_servir_un_modelo"></a>Servir un modelo</h3>
<div class="paragraph">
<p>Vamos a servir el modelo Granite con el siguiente comando:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model serve --model-path /home/instruct/.cache/instructlab/models/granite-7b-lab-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como puede ver, el comando serve puede tomar un argumento opcional --model-path. Si no se proporciona ninguna ruta de modelo, se utilizar√° el valor predeterminado del archivo config.yaml.</p>
</div>
<div class="paragraph">
<p>Este comando en especial, tarda alrededor de unos 10, 15 segundos. Nos toca esperar un poco hasta que muestre el siguiente mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">INFO ... After application startup complete see http://127.0.0.1:8000/docs for API.</code></pre>
</div>
</div>
<div class="paragraph">
<p>¬°Genial! Acabamos de servir nuestro primer modelo y estamos listos para chatear con √©l.</p>
</div>
</div>
<div class="sect2">
<h3 id="_chatear_con_el_modelo"><a class="anchor" href="#_chatear_con_el_modelo"></a>Chatear con el modelo</h3>
<div class="paragraph">
<p>Ya que estamos sirviendo el modelo en el terminal superior, lo dejamos trabajando y pasamos a escribir en el terminal inferior.</p>
</div>
<div class="paragraph">
<p>Debemos volver a activar el entorno virtual Python para ejecutar el comando ilab chat y comunicarnos con el modelo que est√° sirviendo.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/instructlab
source venv/bin/activate</code></pre>
</div>
</div>
<div class="paragraph">
<p>En tu terminal deber√≠a aparecer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">(venv) [instruct@bastion instructlab]$</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya podemos volver a utilizar InstructLab. En este caso usaremos el comando ilab chat.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model chat -m /home/instruct/.cache/instructlab/models/granite-7b-lab-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>El resultado deber√≠a ser una interfaz parecida a esta:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ Welcome to InstructLab Chat w/ MODELS/GRANITE-7B-LAB-Q4_K_M.GGUF
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
&gt;&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tenemos todo listo para hacerle preguntas a nuestro LLM. Vamos a ver si conoce qu√© es Openshift, prueba a escribir:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">What is OpenShift in 20 words or less?</code></pre>
</div>
</div>
<div class="paragraph">
<p>¬°Genial! El modelo responde correctamente y deber√≠a explicar que Openshift es una plataforma de contenerizaci√≥n desarrollada por Red Hat.</p>
</div>
<div class="paragraph">
<p>Puedes continuar haci√©ndole preguntas aunque ten en cuenta lo siguiente: este modelo no dispone de conexi√≥n a internet y su conocimiento, aunque es general, es limitado. ¬°Pero no hay problema! Con InstructLab lo entrenaremos para que aprenda m√°s sobre esas √°reas que nos interesan.</p>
</div>
</div>
<div class="sect2">
<h3 id="_integrar_modelo_en_la_web"><a class="anchor" href="#_integrar_modelo_en_la_web"></a>Integrar modelo en la web</h3>
<div class="paragraph">
<p>Hasta ahora, hemos visto los conceptos b√°sicos de c√≥mo interactuar con InstructLab. Ahora vamos a dar un paso m√°s all√° mediante el uso de InstructLab con una aplicaci√≥n de ejemplo. Vamos a utilizar InstructLab para aprovechar el modelo Granite entren√°ndolo con nuevos conocimientos y permitiendo que responda a las preguntas con eficacia. Esto lo haremos en el contexto de Parasol, una empresa ficticia que procesa las reclamaciones de seguros.</p>
</div>
<div class="paragraph">
<p>Parasol tiene una aplicaci√≥n de chatbot con IA (el modelo Granite) para proporcionar sugerencias de reparaci√≥n para las reclamaciones presentadas. Esto permitir√≠a a Parasol agilizar la tramitaci√≥n de varias reclamaciones en espera.</p>
</div>
<div class="paragraph">
<p>¬°Vamos a poner a prueba Granite usando la web de Parasol!</p>
</div>
<div class="paragraph">
<p>Volvemos a dejar los dos terminales como est√°n y pinchamos en la pesta√±a superior "Parasol".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/parasol-view.png" alt="parasol view">
</div>
</div>
<div class="paragraph">
<p>Lo que veremos ser√° la intefaz de la web de Parasol. Tenemos una tabla en la que cada fila es un caso de reclamaci√≥n distinto. Si tienes curiosidad, puedes tomarte un tiempo para explorar la web.</p>
</div>
<div class="paragraph">
<p>Para continuar con el laboratorio, nos centraremos en el primer caso de la tabla, el que tiene el identificador CLM195501 y ha sido generado por un tal Marty McFly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/parasol-claim.png" alt="parasol claim">
</div>
</div>
<div class="paragraph">
<p>En la p√°gina de la reclamaci√≥n, puedes ver que tenemos informaci√≥n como: la fecha en la que ocurri√≥ el siniestro, el lugar, un resumen de c√≥mo ocurri√≥ el accidente y c√≥mo se siente el cliente.</p>
</div>
<div class="paragraph">
<p>Si miras en la esquina inferior derecha, hay un bot√≥n azul. Vamos a clicarlo para abrir el chat con el modelo Granite. Este chat est√° utilizando el modelo que hemos servido antes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/parasol-chat.webp" alt="parasol chat">
</div>
</div>
<div class="paragraph">
<p>Vamos a imaginar que somos el personal de Parasol que gestiona las reclamaciones y que nos gustar√≠a saber cu√°nto puede costar reparar el condensador de flujo del DeLorean de McFly.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">How much does it cost to repair a flux capacitor?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deber√≠as ver algo parecido a lo siguiente. Ten en cuenta que los LLM no son deterministas por naturaleza. Esto significa que incluso con la misma entrada, el modelo producir√° respuestas variables. Por lo tanto, tus resultados pueden variar ligeramente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/parasol-chat-response.webp" alt="parasol chat response">
</div>
</div>
<div class="paragraph">
<p>Lo que acabamos de hacer es proporcionar informaci√≥n contextual sobre la reclamaci√≥n en una conversaci√≥n con el LLM utilizando Prompt Engineering. Pero, por desgracia, el chatbot no sabe cu√°nto cuesta reparar un condensador de flujo, ni tendr√° ning√∫n conocimiento espec√≠fico del dominio de nuestra organizaci√≥n.</p>
</div>
<div class="paragraph">
<p>Con InstructLab, podemos cambiar eso ense√±ando al modelo.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="entrenamiento"><a class="anchor" href="#entrenamiento"></a>2. Entrenamiento del Modelo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hemos probado a chatear con el modelo y ahora vamos a aprovechar el potencial de InstructLab, centr√°ndonos en <strong>mejorar la taxonom√≠a</strong>. A√±adiremos conocimiento sobre el coche de McFly al modelo para que sepa m√°s sobre sus especificaciones y pueda responder a nuestras preguntas.</p>
</div>
<div class="sect2">
<h3 id="_entender_la_taxonom√≠a"><a class="anchor" href="#_entender_la_taxonom√≠a"></a>Entender la taxonom√≠a</h3>
<div class="paragraph">
<p>¬øTe has preguntado por qu√© InstructLab se llama as√≠?</p>
</div>
<div class="paragraph">
<p>El <strong>m√©todo LAB</strong> (<strong>L</strong>arge-scale <strong>A</strong>lignment for chat<strong>B</strong>ots) se basa en taxonom√≠as. Las taxonom√≠as son archivos YAML que contienen conocimientos y habilidades que InstructLab usa para su generaci√≥n de datos. Estas se crean manualmente y con cuidado.</p>
</div>
<div class="paragraph">
<p>InstructLab facilita el proceso de ajuste y mejora de los modelos mediante la recopilaci√≥n de dos tipos de datos: conocimientos y habilidades. Esta informaci√≥n se recoge en una taxonom√≠a de archivos YAML que se usa en el proceso de generaci√≥n de datos sint√©ticos.</p>
</div>
<div class="paragraph">
<p>En la siguiente imagen puedes ver la estructura que puede tener una taxonom√≠a. Las cajas moradas son nuestros archivos YAML, o mejor dicho QNAs (archivos de preguntas y respuestas). Si desde ah√≠ seguimos hacia las capas de arriba, vemos que los YAML est√°n organizados por su tem√°tica: finanzas, matemasticas, etc&#8230;&#8203; Mientras que si continuamos hacia abajo, vemos su papel en la generaci√≥n de datos sint√©ticos y entrenamiento.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/taxonomy.png" alt="taxonomy">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modificar_la_taxonom√≠a"><a class="anchor" href="#_modificar_la_taxonom√≠a"></a>Modificar la taxonom√≠a</h3>
<div class="paragraph">
<p>Ahora partiendo de una taxonom√≠a vac√≠a, vamos a crear un lugar en el que almacenar informaci√≥n sobre el coche de McFly. Vuelve a la vista Terminales. En la ventana de terminal inferior donde hemos chateado, introduce 'exit' para salir de la sesi√≥n de chat.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p /home/instruct/.local/share/instructlab/taxonomy/knowledge/parasol/claims</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora lo que nos falta es un archivo QNA con los detalles espec√≠ficos del coche. Por suerte, tenemos un PDF con esa informaci√≥n que puedes ver en este <a href="https://github.com/dgpmakes/instructlab-start/blob/master/ilab/DeLorean%20PDF.pdf">link</a>.</p>
</div>
<div class="paragraph">
<p>Siguiente paso. Vamos a utilizar Docling, una herramienta open-source que nos permite f√°cilmente transformar archivos a formatos m√°s convenientes. De esta forma, podremos transformar nuestro PDF en un archivo de texto y as√≠ crear nuesto QNA de forma c√≥moda.</p>
</div>
<div class="paragraph">
<p>Utiliza el siguiente comando para instalar Docling:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pip install docling</code></pre>
</div>
</div>
<div class="paragraph">
<p>Este comando puede tardar alrededor de un minuto, debemos esperar hasta que volvamos a tener la l√≠nea de comandos activa. Mientras, puedes echarle un ojo a la <a href="https://github.com/dgpmakes/instructlab-start/blob/master/ilab/DeLorean%20PDF.pdf">documentaci√≥n</a> de Docling.</p>
</div>
<div class="paragraph">
<p>Una vez instalado, ejecutamos los siguientes comandos para que Docling transforme el PDF correctamente:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /home/instructlab/files/
docling https://github.com/dgpmakes/instructlab-start/raw/refs/heads/master/ilab/DeLorean%20PDF.pdf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si todo ha ido bien, despu√©s de unos segundos deber√≠amos volver a tener el control del terminal. Vamos a echarle un ojo al resultado final.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat /home/instructlab/files/DeLorean%20PDF.md</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, el trabajo de Docling es muy b√°sico. ¬øPero y si tuvieramos un PDF con cientos de p√°ginas? Docling es realmente √∫til a la hora de preprocesar datos en el √°mbito del aprendizaje autom√°tico.</p>
</div>
<div class="paragraph">
<p>Teniendo ya la informaci√≥n en texto plano, solo quedar√≠a crear el archivo QNA y rellenarlo con toda nuestra informaci√≥n.</p>
</div>
<div class="paragraph">
<p>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</p>
</div>
<div class="paragraph">
<p>En el directorio ilab, ya hay preparado un archivo <strong>qna.yaml</strong>. InstructLab usa estos archivos para ense√±ar a los modelos. Estos contienen preguntas y respuestas sobre algo en concreto. Aqu√≠ tienes un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">- answer: The mission of instructlab is to let everyone shape generative AI
    by enabling contributed updates to existing LLMs in an accessible way.
    The community welcomes all those who would like to help enable everyone
    to shape the future of generative AI.
  question: 'What is the mission of Instructlab?'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ahora vamos a incluir las preguntas y respuestas en el directorio que hemos creado.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp qna.yaml ~/.local/share/instructlab/taxonomy/knowledge/instructlab/overview</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para comprobar que la sintaxis del <strong>qna.yaml</strong> es correcta, escribe el siguiente comando:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab taxonomy diff</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deber√≠as obtener lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Taxonomy in /taxonomy/ is valid :)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_entrenar_modelo"><a class="anchor" href="#_entrenar_modelo"></a>Entrenar modelo</h3>
<div class="paragraph">
<p>¬°Perfecto! Hemos a√±adido nuevo conocimiento en la taxonom√≠a. El siguiente paso es generar los datos sint√©ticos.</p>
</div>
<div class="paragraph">
<p>Un modelo maestro usar√° la taxonom√≠a que hemos definido para generar m√°s ejemplos de preguntas y respuestas. Cuantas m√°s preguntas y respuestas tengamos, m√°s s√≥lido ser√° el entrenamiento. Finalmente, entrenamos al modelo con nuestra taxonom√≠a y los datos sint√©ticos.
El resultado ser√° un nuevo modelo que comprenda el conocimiento que hemos indicado. Para m√°s informaci√≥n sobre el entrenamiento, visita este <a href="https://github.com/instructlab/instructlab?tab=readme-ov-file#-creating-new-knowledge-or-skills-and-training-the-model">link</a>.</p>
</div>
<div class="paragraph">
<p>Generar datos sint√©ticos y entrenar lleva <strong>varias horas</strong> y por cuesti√≥n de tiempo, vamos a comprobar el aprendizaje usando el modelo preentrenado. ¬°Como si fuera un programa de cocina!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interaccion"><a class="anchor" href="#interaccion"></a>3. Comprobar modelo entrenado</h2>
<div class="sectionbody">
<div class="paragraph">
<p>¬°Hora de probar el modelo entrenado! Vamos al primer terminal y dejamos de servir el modelo usando <code>CTRL</code>+<code>C</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">INFO 2024-05-06 18:41:08,496 server.py:197 After application startup complete see http://127.0.0.1:8000/docs for API.
^C
Aborted!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Luego, servimos el modelo preentrenado:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model serve --model-path ~/.cache/instructlab/models/ggml-ilab-pretrained-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esperamos unos segundos, volvemos al segundo terminal e iniciamos el chat con el LLM.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model chat -m ~/.cache/instructlab/models/ggml-ilab-pretrained-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>¬°Llega la hora de la verdad! Prueba a preguntar al LLM sobre InstructLab:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Can you give me a short summary of what InstructLab is?</code></pre>
</div>
</div>
<div class="paragraph">
<p>¬°Yuju! La respuesta deber√≠a ser mucho mejor que la √∫ltima vez. El LLM debe ser capaz de explicar que InstructLab.</p>
</div>
<div class="sect2">
<h3 id="_conclusi√≥n"><a class="anchor" href="#_conclusi√≥n"></a>Conclusi√≥n</h3>
<div class="paragraph">
<p><strong>¬°Laboratorio terminado con √©xito!</strong> Esperamos que hayas disfrutado probando de primera mano el potencial de InstructLab. Como peque√±o repaso, has conseguido lo siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chatear con un LLM</p>
</li>
<li>
<p>Modificar la taxonom√≠a de InstructLab</p>
</li>
<li>
<p>Comprobar el desempe√±o del modelo entrenado</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gracias por haber dedicado tu esfuerzo y tiempo a aprender m√°s sobre inteligencia articial y LLMs. Para m√°s informaci√≥n sobre InstructLab, ¬°echa un ojo a la comunidad en Github! <a href="https://github.com/instructlab" class="bare">https://github.com/instructlab</a></p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Antes de empezar</a></span>
  <span class="next"><a href="02-annex.html">Anexo</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
