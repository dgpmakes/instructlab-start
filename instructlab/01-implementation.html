<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Laboratorio :: Summit Connect Madrid - InstructLab</title>
    <link rel="canonical" href="https://github.com/rhcs-workshops/summit-connect-madrid-ilab/instructlab/01-implementation.html">
    <link rel="prev" href="index.html#instructlab">
    <link rel="next" href="02-annex.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/RHDLogo.svg" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://github.com/rhcs-workshops/summit-connect-madrid-ilab">Summit Connect Madrid - InstructLab</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="instructlab" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html#instructlab">¿Qué es InstructLab?</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html#objetivos">Objetivos</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-implementation.html">Laboratorio</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#uso-basico">1. Interactuar con un modelo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#entrenamiento">2. Entrenar modelo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#interaccion">3. Comprobar modelo entrenado</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-annex.html">Anexo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-annex.html#que-es-un-llm">¿Qué es un LLM?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-annex.html#como-entrenar-llm">¿Cómo se entrenan los LLM?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-annex.html#relacion-instructlab">¿Cómo se relaciona con InstructLab?</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">InstructLab</a></li>
    <li><a href="01-implementation.html">Laboratorio</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/rhcs-workshops/summit-connect-madrid-ilab/edit/master/documentation/modules/ROOT/pages/01-implementation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Laboratorio</h1>
<div class="sect1">
<h2 id="uso-basico"><a class="anchor" href="#uso-basico"></a>1. Interactuar con un modelo</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_preparación_del_entorno"><a class="anchor" href="#_preparación_del_entorno"></a>Preparación del entorno</h3>
<div class="paragraph">
<p>Comenzamos en el <mark>terminal azul</mark>. Vamos a establecer un entorno virtual de Python para usar el CLI de InstructLab ya instalado.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/ilab
source venv/bin/activate</code></pre>
</div>
</div>
<div class="paragraph">
<p>¡Perfecto! Ya podemos usar InstructLab con el comando <code>ilab</code>. Para empezar a trabajar, InstructLab necesita <strong>inicializar</strong> para trabajar con los modelos. El comando <code>ilab config init</code> se encarga de:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Localizar la taxonomía por defecto (estructura de conocimientos y habilidades).</p>
</li>
<li>
<p>Crear el archivo de configuración (config.yaml).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El archivo <strong>config.yaml</strong> contiene los valores predeterminados que nos permiten ajustar el comportamiento del modelo a nuestro gusto, como el número de CPUs.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab config init</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Path to taxonomy repo [taxonomy]:
-&gt; Pulsa la tecla ENTER</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">'taxonomy' seems to not exist or is empty. Should I clone?
-&gt; Pulsa la tecla Y, después ENTER</code></pre>
</div>
</div>
<div class="paragraph">
<p>El resultado final de ejecutar el comando es:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">'Initialization completed successfully, you`re ready to start using ilab. Enjoy!'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servir_modelo"><a class="anchor" href="#_servir_modelo"></a>Servir modelo</h3>
<div class="paragraph">
<p>Con el entorno ya configurado, podemos descargar un modelo al directorio local y servirlo para interactuar con él. Por cuestión de tiempo, el modelo ya está descargado.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p ~/ilab/models
cp ~/files/granite-7b-lab-Q4_K_M.gguf ~/ilab/models
cp ~/files/merlinite-7b-lab-Q4_K_M.gguf ~/ilab/models
ilab model serve --model-path models/granite-7b-lab-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Espera a que el output del terminal azul muestre el siguiente mensaje:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">INFO ... After application startup complete see http://127.0.0.1:8000/docs for API.</code></pre>
</div>
</div>
<div class="paragraph">
<p>¡Genial! Estamos listos para probar el LLM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_chatear_con_el_modelo"><a class="anchor" href="#_chatear_con_el_modelo"></a>Chatear con el modelo</h3>
<div class="paragraph">
<p>Vamos a dejar el modelo sirviéndose en el terminal donde hemos trabajado y usaremos el <mark>terminal blanco</mark>. Volvemos a activar el entorno virtual de Python, pero esta vez iniciamos una sesión de chat con el comando <code>ilab model chat</code></p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/ilab
source venv/bin/activate
ilab model chat -m models/granite-7b-lab-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>En tu terminal debería aparecer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">╭───────────────────────────────────────────────────────────────────────────╮
│ Welcome to InstructLab Chat w/ MODELS/GRANITE-7B-LAB-Q4_K_M.GGUF
╰───────────────────────────────────────────────────────────────────────────╯
&gt;&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tenemos todo listo para hacerle preguntas a nuestro LLM. Prueba a escribir:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Can you give me a short summary of what Openshift is?</code></pre>
</div>
</div>
<div class="paragraph">
<p>¡Genial! El modelo debería responder que Openshift es una plataforma de conterización desarrollada por Red Hat.</p>
</div>
<div class="paragraph">
<p>Ahora, prueba a escribir en el chat:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Can you give me a short summary of what InstructLab is?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vaya. El modelo responde que InstructLab es una plataforma educativa, algo que no es cierto y se aleja de la realidad. Este error se suele denominar «<strong>alucinación</strong>» en el mundo de la IA. Para solucionarlo, toca pasar por el entrenamiento. ¡Manos a la obra!</p>
</div>
<div class="paragraph">
<p>Antes de continuar, vamos a cerrar la sesión de chat con el modelo que hemos iniciado en el <mark>terminal blanco</mark>. Escribe 'exit'.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">exit</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="entrenamiento"><a class="anchor" href="#entrenamiento"></a>2. Entrenamiento del Modelo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Una vez que conocemos un poco acerca de IntructLab, vamos a usar su potencial, centrándonos en <strong>mejorar la taxonomía</strong>. Añadiremos conocimiento sobre InstructLab al modelo para que sepa más del proyecto y pueda responder a nuestras preguntas.</p>
</div>
<div class="sect2">
<h3 id="_entender_la_taxonomía"><a class="anchor" href="#_entender_la_taxonomía"></a>Entender la taxonomía</h3>
<div class="paragraph">
<p>¿Te has preguntado por qué InstructLab se llama así?</p>
</div>
<div class="paragraph">
<p>El <strong>método LAB</strong> (<strong>L</strong>arge-scale <strong>A</strong>lignment for chat<strong>B</strong>ots) se basa en taxonomías.
Las taxonomías son archivos YAML que contienen conocimientos y habilidades que InstructLab usa para su generación de datos.</p>
</div>
<div class="paragraph">
<p>Echémosle un ojo a la taxonomía actual.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">taxonomy/
├── CODE_OF_CONDUCT.md
├── compositional_skills
│   ├── arts
│   ├── engineering
│   ├── geography
│   ├── grounded
│   │   ├── arts
│   │   ├── engineering
│   │   ├── geography</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vemos que la taxonomía incluye conocimiento sobre artes, ingeniería, geografía&#8230;&#8203; Vamos a crear un directorio en el que insertar el conocimiento sobre InstructLab. Aún en el <mark>terminal blanco</mark>, introducimos el siguiente comando:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p ~/ilab/taxonomy/knowledge/instructlab/overview</code></pre>
</div>
</div>
<div class="paragraph">
<p>En el entorno, ya hay preparado un archivo <strong>qna.yaml</strong>. InstructLab usa estos archivos para enseñar a los modelos. Estos contienen preguntas y respuestas sobre algo en concreto. Aquí tienes un ejemplo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">- answer: The mission of instructlab is to let everyone shape generative AI
    by enabling contributed updates to existing LLMs in an accessible way.
    The community welcomes all those who would like to help enable everyone
    to shape the future of generative AI.
  question: 'What is the mission of Instructlab?'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copiamos el archivo <strong>qna.yaml</strong> preparado en el directorio que hemos creado.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp ~/files/qna.yml ~/ilab/taxonomy/knowledge/instructlab/overview</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para comprobar que hemos modificado correctamente la taxonomía, escribe el siguiente comando:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab taxonomy diff</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deberías obtener lo siguiente:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Taxonomy in /taxonomy/ is valid :)</code></pre>
</div>
</div>
<div class="paragraph">
<p>¡Perfecto! Tenemos todo listo para entrenar.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entrenar_modelo"><a class="anchor" href="#_entrenar_modelo"></a>Entrenar modelo</h3>
<div class="paragraph">
<p>Entrenar lleva <strong>varias horas</strong> y por cuestión de tiempo, tenemos preparado un modelo ya entrenado. ¡Como si fuera un programa de cocina!</p>
</div>
<div class="paragraph">
<p>En el entrenamiento, un modelo maestro (Merlinite en este caso) usa la taxonomía que hemos definido para generar más ejemplos de preguntas y respuestas. Después, entrenaremos al modelo con ellos. Cuantas más preguntas y respuestas, más sólido será el entrenamiento. El resultado será un nuevo modelo que comprenda el conocimiento que le hemos indicado.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interaccion"><a class="anchor" href="#interaccion"></a>3. Comprobar modelo entrenado</h2>
<div class="sectionbody">
<div class="paragraph">
<p>¡Hora de probar el modelo entrenado! Vamos al <mark>terminal azul</mark> y dejamos de servir el modelo antiguo usando <code>CTRL</code>+<code>C</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">INFO 2024-05-06 18:41:08,496 server.py:197 After application startup complete see http://127.0.0.1:8000/docs for API.
^C
Aborted!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Luego, servimos el modelo preentrenado:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp ~/files/ggml-ilab-pretrained-Q4_K_M.gguf ~/ilab/models
ilab model serve --model-path models/ggml-ilab-pretrained-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Volvemos al <mark>terminal blanco</mark> e iniciamos el chat con el LLM.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ilab model chat --greedy-mode -m models/ggml-ilab-pretrained-Q4_K_M.gguf</code></pre>
</div>
</div>
<div class="paragraph">
<p>¡Llega la hora de la verdad! Prueba a preguntar al LLM sobre InstructLab:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Can you give me a short summary of what InstructLab is?</code></pre>
</div>
</div>
<div class="paragraph">
<p>¡Yuju! La respuesta debería ser mucho mejor que la última vez. El LLM debe ser capaz de explicar que InstructLab.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusión"><a class="anchor" href="#_conclusión"></a>Conclusión</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>¡Laboratorio terminado con éxito!</strong> Esperamos que hayas disfrutado probando de primera mano el potencial de InstructLab. Como pequeño repaso, has conseguido lo siguiente:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chatear con un LLM</p>
</li>
<li>
<p>Modificar la taxonomía de InstructLab</p>
</li>
<li>
<p>Comprobar el desempeño del modelo entrenado</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Gracias por haber dedicado tu esfuerzo y tiempo en a aprender más sobre inteligencia articial y LLMs. Para más información sobre InstructLab, ¡echa un ojo a la comunidad en Github! <a href="https://github.com/instructlab" class="bare">https://github.com/instructlab</a></p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html#instructlab">¿Qué es InstructLab?</a></span>
  <span class="next"><a href="02-annex.html">Anexo</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
